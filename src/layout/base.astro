---
import '@/styles/globals.sass'
import '@/layout/base.sass'
import { getLangCode, getRoot, useLang } from '@/i18n'

import banner from '@/assets/banner.png'
import iconMenu from '@/assets/buttons/menu.svg'
import iconExternal from '@/assets/buttons/external.svg'
import iconClose from '@/assets/buttons/close.svg'

const { title } = Astro.props

const code = getLangCode(Astro.url)
const root = getRoot(code)
const t = useLang(code)
---

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" type="image/png" href="/favicon.png" />
  <title>{title}</title>
</head>

<body>
  <a class="menu-expander" data-icon-menu={iconMenu} data-icon-close={iconClose} >
    <img class="menu-expander__icon" src={iconMenu} alt="menu toggler" />
  </a>

  <div class="menu-fs hidden">
    <div class="menu-fs__container">
      <a class="menu-fs__link" href="https://idl.ist/">
        <img class="menu-fs__link-external" src={iconExternal} alt="external" />
        <span class="menu-fs__link-text">{t('ui.to-index')}</span>
      </a>
      <hr class="menu-fs__hr" />
      <div class="menu-fs__link-title">{t('ui.language')}</div>
      <a class="menu-fs__link" href="/">简体中文</a>
      <a class="menu-fs__link" href="/en/">English</a>
      <a class="menu-fs__link" href="/ja/">日本語</a>
      <hr class="menu-fs__hr" />
      <a class="menu-fs__link" href={root}>{t('ui.articles')}</a>
      <hr class="menu-fs__hr" />
    </div>
  </div>

  <header>
    <div class="header-container">
      <div class="header">
        <img class="header__banner" src={banner} alt="banner" />
        <hr class="header__divider" />
        <div>i'D Blog</div>
      </div>

      <div class="menu-header">
        <a class="menu-link" href={root}>{t('ui.articles')}</a>
        <div class="menu-link__dropdown">
          <div>{t('ui.language')}</div>
          <div class="menu-link__dropdown-content">
            <a class="menu-link__dropdown-link" href="/">简体中文</a>
            <a class="menu-link__dropdown-link" href="/en/">English</a>
            <a class="menu-link__dropdown-link" href="/ja/">日本語</a>
          </div>
        </div>
        <a class="menu-link" href="https://idl.ist/">
          <img class="menu-link__external" src={iconExternal} alt="external" />
          <span>{t('ui.to-index')}</span>
        </a>
      </div>
    </div>
  </header>

  <slot></slot>

  <div id="bg-tiles"></div>
</body>

<script>
  const Menu = document.querySelector('.menu-expander') as HTMLLinkElement
  const MenuIcon = Menu.querySelector('.menu-expander__icon') as HTMLImageElement
  const MenuDropdown = document.querySelector('.menu-fs') as HTMLElement
  const iconMenu = Menu.dataset.iconMenu ?? ''
  const iconClose = Menu.dataset.iconClose ?? ''

  Menu.addEventListener('click', () => {
    MenuDropdown.classList.toggle('hidden')
    const state = MenuDropdown.classList.contains('hidden')
    MenuIcon.setAttribute('src', state ? iconMenu : iconClose)
  })
</script>